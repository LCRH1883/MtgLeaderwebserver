#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")/.." && pwd)"

if [[ -z "${APP_DB_DSN:-}" ]]; then
  echo "APP_DB_DSN is required (e.g. export APP_DB_DSN=postgres://...)" >&2
  exit 1
fi

cmd="${1:-up}"
shift || true

exec "${ROOT_DIR}/scripts/go" run github.com/pressly/goose/v3/cmd/goose@v3.21.1 \
  -dir "${ROOT_DIR}/migrations" \
  postgres "${APP_DB_DSN}" \
  "${cmd}" "$@"

